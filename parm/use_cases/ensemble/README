
README

This README describes general information related to the current
implemenation of the ensemble use case.


2019 july 15
===============================================================================

Overview:

*)
FCST_VAR<n>_ vars: Are now supported in METplus for ensemble stat.
You can now run ensemble_stat one field variable at a time, as you can
with grid_stat. To do so, you use the following settings in the
ensemble_stat use case conf file.

Set ens, fcst, obs field variables in the MET config file.
Variables and levels as specified in the field dictionary of the MET
configuration file. Specify as FCST_VARn_NAME, FCST_VARn_LEVELS,
(optional) FCST_VARn_OPTION

FCST_VAR1_NAME = TMP
FCST_VAR1_LEVELS = Z2
FCST_VAR2_NAME = RH
FCST_VAR2_LEVELS = Z2
FCST_VAR3_NAME = TCDC
FCST_VAR3_LEVELS = L0
FCST_VAR3_OPTIONS = GRIB_lvl_typ = 200

Optionally, if you choose, you can set the field variables in the 
MET config file, in which case, all variables are processed at the 
same time. See the MET documentation for settings.

*)
Regarding specifying the filename template for ensemble filenames, 
In additions to the standard time support, you must use either 
filename wildcards OR specifically list ALL the members.
The time format keywords supported, in either case are: init?fmt= and lead?fmt=
ie.
FCST_ENSEMBLE_STAT_INPUT_TEMPLATE = {init?fmt=%Y%m%d%H}/postprd_mem000?/wrfprs_conus_mem000?_{lead?fmt=%HH}.grib2

FCST_ENSEMBLE_STAT_INPUT_TEMPLATE =
    {init?fmt=%Y%m%d%H}/postprd_mem0001/wrfprs_conus_mem0001_{lead?fmt=%HH}.grib2,
    {init?fmt=%Y%m%d%H}/postprd_mem0002/wrfprs_conus_mem0002_{lead?fmt=%HH}.grib2,
    {init?fmt=%Y%m%d%H}/postprd_mem0003/wrfprs_conus_mem0003_{lead?fmt=%HH}.grib2,
    {init?fmt=%Y%m%d%H}/postprd_mem0004/wrfprs_conus_mem0004_{lead?fmt=%HH}.grib2,
    {init?fmt=%Y%m%d%H}/postprd_mem0005/wrfprs_conus_mem0005_{lead?fmt=%HH}.grib2,
    {init?fmt=%Y%m%d%H}/postprd_mem0006/wrfprs_conus_mem0006_{lead?fmt=%HH}.grib2,
    {init?fmt=%Y%m%d%H}/postprd_mem0007/wrfprs_conus_mem0007_{lead?fmt=%HH}.grib2,
    {init?fmt=%Y%m%d%H}/postprd_mem0008/wrfprs_conus_mem0008_{lead?fmt=%HH}.grib2,
    {init?fmt=%Y%m%d%H}/postprd_mem0009/wrfprs_conus_mem0009_{lead?fmt=%HH}.grib2

-----------------

NOTE THE FOLLOWING.
This use case has ONLY been tested with the following settings/versions.
 
*)
The observations error table was officailly added in MET version 8.0.

Refer to the correct table in the METplus ensemble use case
file in the parm/use_cases/ensemble/examples directory.

Currently the default is setup to refer to the 8.0 table.
MET_OBS_ERROR_TABLE = {CONFIG_DIR}/table_files/obs_error_table_V8.0.txt

Note: To refrence the default version that is distribued with MET,
edit the METplus ensemble conf file under parm/use_cases/ensemble/examples
and do not set a value by defining METplus configuration variable as follows;
MET_OBS_ERROR_TABLE = 

*)
YOU MUST USE THE following METplus CONF settings ...
Anything other than the following has not been tested
for the ensemble stat use case.

LOOP_ORDER = processes  (pb2nc, ensemble_stat)

LOOP_BY = INIT     (ensemble_stat) see below for details.

*)
PB2NC requires  /YYYYMMDD subdirectories for prepbufr input file 
struture to run pb2nc. 

*)
Recommend read: MET configuration file README

MET_INSTALL_DIR/share/met/config/README

// The "tmp_dir" entry in ConfigConstants defines the directory for the
// temporary files. The directory must exist and be writable. The environment
// variable MET_TMP_DIR overrides the default value at the configuration file.
// Some tools override the temporary directory by the command line argument
// "-tmp_dir <diretory_name>".
tmp_dir = "/tmp";


// By default, the MET_BASE/data/table_files/obs_error_table.txt file is read
// but this may be overridden by setting the $MET_OBS_ERROR_TABLE environment
// variable at runtime.


*)
Some examples to help show settings and behavior.
==================================================
GSD HRRRE SFC Test Case example.

These are the settings you would use if you had the following:

1. init time 2018070912 with 37 hourly lead times ... with leads 00 ... 36

LOOP_BY_INIT = True
INIT_BEG=2018070912
INIT_END=2018070912
INIT_INCREMENT=3600 ( 1 hour, but will not be used since I have 1 init time ...)
LEAD_SEQ=0,1, 2, 3, ... 35, 36     (In short ...)

======================================================
The following is an example to explain the behavior of LOOP_BY_INIT = True or False

LOOP_BY_INIT = True
Step through initialization times and loop through each forecast lead relative to that init time

Example:
LOOP_BY_INIT = True
INIT_BEG=2018010100
INIT_END=2018010112
INIT_INCREMENT=21600 (6 hours)
LEAD_SEQ=3, 6

This will run 
20180101 00Z initialization, 3 hr forecast valid 20180101 03Z
20180101 00Z initialization, 6 hr forecast valid 20180101 06Z
20180101 06Z initialization, 3 hr forecast valid 20180101 09Z
20180101 06Z initialization, 6 hr forecast valid 20180101 12Z
20180101 12Z initialization, 3 hr forecast valid 20180101 15Z
20180101 12Z initialization, 6 hr forecast valid 20180101 18Z

LOOP_BY_INIT = False
Step through valid times and loop through each forecast lead relative to that init time

Example:
LOOP_BY_INIT = False
VALID_BEG=2018010100
VALID_END=2018010112
VALID_INCREMENT=21600 (6 hours)
LEAD_SEQ=3, 6

This will run 
20180101 00Z valid, 3 hr forecast initialized 20171231 21Z
20180101 00Z valid, 6 hr forecast initialized 20171231 18Z
20180101 06Z valid, 3 hr forecast initialized 20180101 03Z
20180101 06Z valid, 6 hr forecast initialized 20180101 00Z
20180101 12Z valid, 3 hr forecast initialized 20180101 09Z
20180101 12Z valid, 6 hr forecast initialized 20180101 06Z

The method of looping will determine how the output files are named (valid or init time).

